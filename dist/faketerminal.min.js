window.FakeTerminal||(window.FakeTerminal={}),window.FakeTerminal.command||(window.FakeTerminal.command={}),window.FakeTerminal.defaultOptions={theme:"default",username:"root",hostname:window.location.host,historyLength:1e3,prompt:"%hostname%: %cwd% %username%$ ",loginCommand:null,cwd:"~"},window.FakeTerminal.keymap={ENTER:13,UP:38,DOWN:40,C:67,U:85},window.FakeTerminal.main=function(a,b){var c=this;if(!jQuery)throw"FakeTerminal: jQuery required";var d=jQuery;c.$el=d(a),c.el=a,c.originalHtml="",c.existing="",c.commands=[],c.history=[],c.historyIndex=null,c.executingCommand=null,c.theScreen=null,c.theCommand=null,c.thePrompt=null,c.theInput=null,c.theRequestInput=null,c.__construct=function(){c.options=d.extend({},window.FakeTerminal.defaultOptions,b),c.originalHtml=c.el.outerHTML,c.setup(),c.registerCommands(),c.focusCommandInput(),c.options.loginCommand&&c.exec(c.options.loginCommand)},c.setup=function(){c.$el.addClass("faketerminal"),c.$el.addClass("faketerminal-theme-"+c.options.theme),c.existing=c.$el.html().split("\n");var a,b,e,f,g;a=d("<ul>"),b=d("<li>").addClass("ft-command"),e=d("<span>").addClass("ft-prompt"),f=d("<span>").addClass("ft-input").prop("contenteditable",!0),g=d("<span>").addClass("ft-request-input").prop("contenteditable",!0),c.$el.empty().append(a.append(b.append(e).append(f).append(g))),c.theScreen=c.$el.find(">ul"),c.theCommand=c.theScreen.find("li.ft-command"),c.thePrompt=c.theCommand.find(".ft-prompt"),c.theInput=c.theCommand.find(".ft-input"),c.theRequestInput=c.theCommand.find(".ft-request-input"),c.setPrompt(),c.theInput.on("keydown",function(a){switch(a.which){case window.FakeTerminal.keymap.ENTER:c.$el.trigger("ft:command",[c,c.getCommandInput()]),c.enterCommandInput();break;case window.FakeTerminal.keymap.UP:c.browseHistory("UP");break;case window.FakeTerminal.keymap.DOWN:c.browseHistory("DOWN")}}),c.theInput.on("keyup",function(a){switch(a.which){case window.FakeTerminal.keymap.ENTER:c.setCommandInput("")}}),c.theRequestInput.on("keyup",function(a){switch(a.which){case window.FakeTerminal.keymap.ENTER:c.setRequestInput("")}}),c.$el.on("click",function(){c.theInput.is(":visible")?c.focusCommandInput():c.theRequestInput.is(":visible")&&c.focusRequestInput()}).on("keyup",function(a){a.ctrlKey&&a.which===window.FakeTerminal.keymap.C?c.ctrl(window.FakeTerminal.keymap.C):a.ctrlKey&&a.which===window.FakeTerminal.keymap.U&&c.ctrl(window.FakeTerminal.keymap.U)}),d.each(c.existing,function(a,b){c.addLine(b)})},c.registerCommands=function(){"object"==typeof window.FakeTerminal.command&&d.each(window.FakeTerminal.command,function(a,b){c.commands[a]=new b(c)})},c.commandHide=function(){c.theCommand.hide()},c.commandShow=function(){c.theCommand.show()},c.setPrompt=function(a,b,e){void 0!==a&&0!==d.trim(a).length||(a="function"==typeof c.options.hostname?c.options.hostname.call():c.options.hostname),void 0!==b&&0!==d.trim(b).length||(b="function"==typeof c.options.username?c.options.username.call():c.options.username),void 0!==e&&0!==d.trim(e).length||(e="function"==typeof c.options.cwd?c.options.cwd.call():c.options.cwd),b=b.toLowerCase().replace(/[^a-z0-9]/g,"");var f=c.options.prompt;f=f.replace(/%hostname%/g,a),f=f.replace(/%username%/g,b),f=f.replace(/%cwd%/g,e),c.setPromptStr(f)},c.setPromptStr=function(a){c.thePrompt.html(a),c.theInput.css("padding-left",c.thePrompt.outerWidth()),c.theRequestInput.css("padding-left",c.thePrompt.outerWidth())},c.getPrompt=function(){return c.thePrompt.text()},c.addLine=function(a){a=d.parseHTML(a);var b="",e="";d(a).each(function(a,c){3===d(c).get(0).nodeType?e=d(c).get(0).nodeValue.replace(/ /g,"&nbsp;"):(d(c).html(d(c).text().replace(/ /g,"&nbsp;")),e=d(c).prop("outerHTML")),b+=e});var f=d("<li>").html(b);return c.theCommand.before(f),c.scrollTerminalToBottom(),c},c.scrollTerminalToBottom=function(){var a=0;d.each(c.theScreen.find(">li"),function(b){a+=d(this).outerHeight()}),c.theScreen.scrollTop(a)},c.browseHistory=function(a){"UP"===a?(null===c.historyIndex&&(c.historyIndex=c.history.length),--c.historyIndex<0&&(c.historyIndex=0)):"DOWN"===a&&(null===c.historyIndex&&(c.historyIndex=0),++c.historyIndex>=c.history.length&&(c.historyIndex=c.history.length));var b=c.history[c.historyIndex]||"";return c.setCommandInput(b),c},c.enterCommandInput=function(a){var b,e,f;return b=c.getCommandInput(),c.theInput.empty(),c.addLine(c.getPrompt()+b),e=b.split(" ").slice(0,1),e=d.trim(e),f=b.split(" ").slice(1),"object"==typeof c.commands[e]?(c.executingCommand&&(c.executingCommand.reject(),c.executingCommand=null),c.commandHide(),c.executingCommand=c.commands[e].execute(f,c).always(function(){c.commandShow(),c.focusCommandInput(),c.scrollTerminalToBottom()})):e.length>0&&c.addLine('command not found: "'+e+'"'),!a&&b.length>0&&c.history.push(b),c.historyIndex=null,c.$el.trigger("ft:command",[c,b]),c},c.setCommandInput=function(a){return c.theInput.text(a),c},c.getCommandInput=function(){return d.trim(c.theInput.text())},c.focusCommandInput=function(){return c.theCommand.removeClass("ft-request-input"),c.theInput.empty().focus(),c},c.requestInput=function(a,b,e,f){var g,h;c.commandShow(),c.theCommand.addClass("ft-request-input"),g='<span class="ft-info">?</span> '+a+": ",g+='<span class="ft-mute">('+b+")</span>",c.setPromptStr(g),c.focusRequestInput(),c.theRequestInput.off("keydown"),c.theRequestInput.on("keydown",function(a){switch(h=!0,a.which){case window.FakeTerminal.keymap.ENTER:c.$el.trigger("ft:command",[c,c.getRequestInput()]),c.focusCommandInput(),c.setPrompt(),c.commandHide(),value=d.trim(c.theRequestInput.text()),0===value.length&&(value=b),f[e](value),h=!1;break;case window.FakeTerminal.keymap.C:a.ctrlKey&&c.ctrlC()}return h})},c.setRequestInput=function(a){return c.theRequestInput.text(a),c},c.getRequestInput=function(){return d.trim(c.theRequestInput.text())},c.focusRequestInput=function(){return c.theCommand.addClass("ft-request-input"),c.theRequestInput.empty().focus(),c},c.ctrl=function(a){switch(a){case window.FakeTerminal.keymap.C:c.ctrlC();break;case window.FakeTerminal.keymap.U:c.ctrlU()}},c.ctrlC=function(){c.setPrompt(),c.executingCommand?(c.executingCommand.reject(),c.executingCommand=null,c.addLine("^C")):c.addLine(c.getPrompt()+c.getCommandInput()),c.focusCommandInput()},c.ctrlU=function(){c.setCommandInput("")},c.destroy=function(){return c.$el.replaceWith(d(c.originalHtml)),c},c.exec=function(a,b){if(d.isArray(a))for(var e=0,f=a.length;e<f;e++)c.exec(a[e],b);else c.setCommandInput(a),c.enterCommandInput(b);return c},c.log=function(){"function"==typeof console&&console.log.apply(c,arguments)},c.warn=function(){"function"==typeof console&&console.warn.apply(c,arguments)},c.error=function(){"function"==typeof console&&console.error.apply(c,arguments)},c.__construct()},window.FakeTerminal.command._base=function(a){var b=this;b.info=function(){return{private:!0}},b.write=function(c){return a.addLine(c),b},b.execute=function(a){return new $.Deferred}},window.FakeTerminal.command.clear=function(a){window.FakeTerminal.command._base.apply(this,arguments);var b=this;return b.info=function(){return{description:"Clears the screen"}},b.execute=function(b){var c=new $.Deferred;return a.theScreen.find("li:not(.ft-command)").remove(),c.resolve(),c},b},window.FakeTerminal.command.echo=function(a){window.FakeTerminal.command._base.apply(this,arguments);var b=this;return b.info=function(){return{description:"Writes an argument to the standard output"}},b.execute=function(a){var c,d=new $.Deferred;return c=a.join(" "),c=$.trim(c),c=c.replace(/["']/g,""),c=c.replace(/["']/g,""),0===c.length&&(c=" "),b.write(c),d.resolve(),d},b},window.FakeTerminal.command.help=function(a){window.FakeTerminal.command._base.apply(this,arguments);var b=this;return b.info=function(){return{description:"Displays information about the available commands"}},b.execute=function(c){var d,e=new $.Deferred,f=[],g={};if(0===c.length){f.push('The following commands are available, run <span class="ft-info">help [command]</span> to find out more.'),f.push(" ");var h="";$.each(window.FakeTerminal.command,function(b,c){var d=new window.FakeTerminal.command[b](a);"function"==typeof d.info&&(g=d.info(),"boolean"==typeof g.private&&!0===g.private)||(h+=b+"    ")}),f.push(h),f.push(" ")}else{var i=c[0],j=!1;$.each(window.FakeTerminal.command,function(a,b){a===i&&(j=!0)}),j?(d=new window.FakeTerminal.command[i](a),"function"==typeof d.info&&(g=d.info(),"string"==typeof g.description?f=[" ",i+" -- "+g.description," "]:"object"==typeof g.description&&(f=g.description)),0===f.length&&(f=[" ",'No description for "'+i+'"'," "])):f=[" ",'"'+i+'" is not a valid command'," "]}for(var k=0;k<f.length;k++)b.write(f[k]);return e.resolve(),e},b},window.FakeTerminal.command.man=function(){return window.FakeTerminal.command.help.apply(this,arguments),this},window.FakeTerminal.command.history=function(a){window.FakeTerminal.command._base.apply(this,arguments);var b=this;return b.info=function(){return{description:"Displays the command history, up to "+a.options.historyLength+" items"}},b.execute=function(c){var d=new $.Deferred;b.write("  ");for(var e=0;e<a.history.length;e++)b.write(e+"  "+a.history[e]);return b.write("  "),d.resolve(),d},b},window.FakeTerminal.command.sleep=function(a){window.FakeTerminal.command._base.apply(this,arguments);var b=this;return b.info=function(){return{description:"Does nothing for a short while"}},b.execute=function(a){var b=new $.Deferred,c=0;return a.length&&(c=parseInt(a[0])),setTimeout(function(){b.resolve()},1e3*c),b},b},function(a){a.fn.faketerminal=function(b){return this.each(function(){a(this).data("instance",new window.FakeTerminal.main(this,b))})}}(jQuery);
//# sourceMappingURL=faketerminal.min.js.map